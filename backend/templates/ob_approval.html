<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" type="text/css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Official Business Approval</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='kubota_icon.png') }}">
    <style>
        /* ... (keep existing styles, they seem generic enough) ... */
        .textarea-container {
            padding: 10px;
        }
        .textarea-container textarea {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
        }
        .destinations-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .destination-box {
            border: 1px solid #ccc;
            padding: 8px 12px;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        @media print {
        .destination-box {
            border: 1px solid #ddd;
            margin-bottom: 5px;
            page-break-inside: avoid;
            }
        }

        .services-container {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        }
        
        .checkbox-display, .radio-display {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .checkbox-icon, .radio-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 1px solid #555;
            border-radius: 3px;
            margin-right: 10px;
            text-align: center;
            line-height: 18px;
            background-color: white;
        }
        
        .radio-icon {
            border-radius: 50%;
        }
        
        .checkbox-label, .radio-label {
            font-size: 16px;
        }
        
        .nested-options {
            margin-left: 30px;
            margin-top: 5px;
        }
        
        .radio-display-group {
            margin-bottom: 10px;
        }
        .btn-disabled {
            background-color: #cccccc !important;
            color: #666666 !important;
            cursor: not-allowed !important;
            opacity: 0.7;
        }
        
        .input-disabled {
            background-color: #f5f5f5 !important;
            cursor: not-allowed !important;
            border-color: #ddd !important;
        }
        
        .current-user-row {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .approval-status-message {
            padding: 10px;
            margin: 10px 0;
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        .cash-advance-mode #approve-btn,
        .cash-advance-mode #reject-btn {
            display: none !important;
        }
        
        .cash-advance-mode #proceed-btn {
            display: inline-block !important;
        }
        .send-btn,
        .btn.btn-warning {
            background-color: #f0ad4e;
            color: #fff;
            border: none;
            padding: 8px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            margin-bottom: 9px;
            transition: background 0.2s;
        }

        .send-btn:hover,
        .btn.btn-warning:hover {
            background-color: #ec971f;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <strong class="head-text">Kubota Philippines Inc.</strong>
            <p class="subhead-text">232 Quirino High, Brgy. Baesa, Quezon City</p>
        </header>
        
        <form id="ob-approval-form">
            <div class="form">
                <header>
                    <strong class="head-text">Official Business Approval</strong>
                </header>

                <!-- Official Business Details Section -->
                <div class="fields ob-details">
                    <div class="field-right">
                        <div class="input-field">
                            <label class="subhead-text bold">Date Filed</label>
                            <input id="dateFiled" class="subhead-text" type="text" readonly>
                        </div>
                        <div class="input-field">
                            <label class="subhead-text bold">Employee ID</label>
                            <input id="employeeId" class="subhead-text" type="text" readonly>
                        </div>
                        <div class="input-field">
                            <label class="subhead-text bold">Employee Name</label>
                            <input id="employeeName" class="subhead-text" type="text" readonly>
                        </div>
                        <div class="input-field">
                            <label class="subhead-text bold">Department/Section</label>
                            <input id="department" class="subhead-text" type="text" readonly>
                        </div>
                        <div class="input-field">
                            <label class="subhead-text bold">Position</label>
                            <input id="position" class="subhead-text" type="text" readonly>
                        </div>
                    </div>

                    <div class="field-left">
                        <div class="input-field">
                            <label class="subhead-text bold">Type</label>
                            <input id="obType" class="subhead-text" type="text" value="Official Business" readonly>
                        </div>
                        <div class="double-input-field">
                            <div class="input-field">
                                <label class="subhead-text bold">Start Date & Time</label>
                                <input id="startDate" class="subhead-text" type="text" readonly>
                            </div>
                            <div class="input-field">
                                <label class="subhead-text bold">End Date & Time</label>
                                <input id="endDate" class="subhead-text" type="text" readonly>
                            </div>
                        </div>

                        <div class="input-field" id="origin-container">
                            <label class="subhead-text bold">Origin</label>
                            <input id="origin" class="subhead-text" type="text" readonly>
                        </div>
                        
                        <div class="input-field" id="destination-container">
                            <label class="subhead-text bold">Destination(s)</label>
                            <div id="destinations-list" class="destinations-list">
                                <!-- Destinations will be populated by JavaScript -->
                            </div>
                        </div>
                         <div class="summary">
                            <label class="title-text bold">Services Required</label>
                            <div class="summary-content">
                                <div id="services-required-display" class="services-container">
                                    <!-- Services will be populated by JavaScript -->
                                    <p>Loading services...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purpose Section -->
                <div class="purpose-container">
                    <header>
                        <p class="subhead-text">Request for authority for Official Business</p>
                    </header>
                    <div class="purpose">
                        <div class="purpose-content">
                            <div class="fields">
                                <div class="input-field">
                                    <label class="title-text bold">A. Purpose / Justification</label>
                                    <textarea id="purpose" class="subhead-text" rows="4" readonly></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Approvers Table -->
                <div class="summary">
                    <label class="title-text bold">B. Approvers</label>
                        <div class="summary-content">
                            <table class="summary-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <th>Status</th>
                                        <th>Date Approved</th>
                                    </tr>
                                </thead>
                                <tbody id="approval-table-body">
                                    {% for approver in ob_data.approvers %}
                                    <!-- Rows will be dynamically populated here -->

                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                
                <!-- Remarks for current approver -->
                <div class="input-field textarea-container">
                    <label class="subhead-text bold">Remarks (if rejecting)</label>
                    <textarea id="remarks" class="subhead-text" rows="4" cols="50" placeholder="Type your remarks here..."></textarea>
                </div>

                <div class="button-container">
                    <div class="left-section">
                        <a href="{{ url_for('logout') }}" class="btn-submit logout-button">Logout</a>
                        <a href="{{ url_for('homepage') }}" class="btn-submit home-button" style="margin-left: 10px;">Home</a>
                        {% set is_current_approver = approvers | selectattr('employeeId', 'equalto', current_user.employeeId) | selectattr('status', 'equalto', 'Pending') | list | length > 0 %}
                        {% set is_first_approver = approvers and approvers[0].employeeId == current_user.employeeId and approvers[0].status == 'Pending' %}
                        {% if is_current_approver and not is_first_approver %}
                            <button id="send-btn" class="btn btn-warning" type="button" onclick="sendBackRequest()">Send Back</button>
                        {% endif %}
                    </div>
                    <div class="right-section">
                        <button id="approve-btn" class="btn-submit" type="button">Approve</button>
                        {% if approvers and approvers[0].employeeId == current_user.employeeId and approvers[0].status == 'Pending' %}
                            <button id="reject-btn" class="btn-submit btn-reject" type="button" onclick="rejectRequest()">Reject</button>
                        {% endif %}
                        <button id="print-btn" class="btn-print" type="button" onclick="printPage()">Print</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script src="{{ url_for('static', filename='ob.js') }}"></script>
    <script>
    var obNumber = "{{ ob_number }}";   
    var currentUserId = "{{ current_user.employeeId }}";
    
    </script>
</body>
</html>